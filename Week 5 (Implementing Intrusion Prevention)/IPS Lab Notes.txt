==========================
IOS IPS - Lab Notes
==========================

1. Definition:
-------------
- IPS = Intrusion Prevention System
- Monitors network traffic for malicious patterns
- Can alert, drop packets, or reset connections
- Works inline or in promiscuous (monitor-only) mode

2. Components:
-------------
- Signatures: Attack definitions (loaded from .sig files)
- IPS Engine: Scans traffic against signatures
- Event Actions:
  * produce-alert     --> generate log/SNMP alert
  * drop-packet-inline --> block malicious packet
  * reset-tcp-connection --> terminate TCP session
- Logging: Local buffer, syslog, SNMP

3. How It Works:
----------------
- Traffic enters interface
- IPS engine scans packets against loaded signatures
- Match triggers configured event-action
- Modes:
  * Inline --> actively blocks traffic
  * Promiscuous --> monitors only, no blocking

4. Basic Configuration:
----------------------

1. Create IPS directory
----------------------
R1# mkdir unix:ipsdir
Tip: Make sure the directory is empty and accessible; IPS will store configuration/signatures here.

2. Configure public key
-----------------------
R1(config)# crypto key pubkey-chain rsa
R1(config-pubkey-chain)# named-key realm-cisco.pub signature
R1(config-pubkey-key)# key-string
# Paste hexadecimal public key
R1(config-pubkey)# <paste key>
R1(config-pubkey)# quit
Tip: Double-check the hex key formatting. Missing characters break IPS authentication.

3. Enable IPS
-------------
R1(config)# ip ips name iosips
R1(config)# ip ips config location unix:ipsdir
Tip: Use a simple, memorable name for IPS. Avoid spaces or special chars.

4. Enable event notifications
-----------------------------
R1(config)# ip http server
R1(config)# ip ips notify sdee
R1(config)# ip ips notify log
Tip: SDEE notification requires HTTP server. If you skip ip http server, SDEE won’t work.

5. (Optional) Configure syslog
-------------------------------
R1(config)# logging 192.168.1.3
Tip: Set your syslog server before testing; logging helps verify IPS activity.

6. Configure signature categories
---------------------------------
R1(config)# ip ips signature-category
R1(config-ips-category)# category all
R1(config-ips-category-action)# retired true
R1(config-ips-category-action)# exit
R1(config-ips-category)# category ios_ips basic
R1(config-ips-category-action)# retired false
R1(config-ips-category-action)# exit
R1(config-ips-category)# exit
Tip: Only enable categories needed for your lab. Retired signatures won’t trigger events.

7. Load signature package
-------------------------
# copy tftp://192.168.1.3/IOS-S855-CLI.pkg idconf
Tip: Ensure TFTP server is reachable and the file exists. Watch the console for compilation messages.

8. Enable IPS on interface
---------------------------
R1(config)# interface Serial1/1
R1(config-if)# ip ips iosips in
Tip: Apply IPS inbound where traffic enters the router. Outbound protection is optional in labs.

9. Verify signatures
--------------------
R1# show ip ips signature count
Tip: Run this after loading the package to confirm all signatures are active.

10. Configure individual signature actions
------------------------------------------
R1(config)# ip ips signature-definition
R1(config-sigdef)# signature 2004 0
R1(config-sigdef-sig)# status
R1(config-sigdef-sig-status)# retired false
R1(config-sigdef-sig-status)# enabled true
R1(config-sigdef-sig-status)# engine
R1(config-sigdef-sig-engine)# event-action produce-alert
R1(config-sigdef-sig-engine)# event-action deny-packet-inline
R1(config-sigdef-sig-engine)# event-action reset-tcp-connection
R1(config-sigdef-sig-engine)# exit
R1(config-sigdef-sig)# exit
R1(config-sigdef)# exit
Tip: Alerts show in SDEE/logs; deny-packet-inline blocks suspicious traffic immediately. Reset-TCP only affects TCP sessions.

==========================
Lab Notes End
==========================
